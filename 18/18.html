<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Улучшенная доступность - Lighthouse</title>
  <style>
    .btn { background: #0056b3; color: white; padding: 10px; border: none; cursor: pointer; }
    .text { color: #333; }
    .image { width: 300px; }
    .form-group { margin: 15px 0; }
    .required { color: #d63384; }
    .error { color: #d63384; font-size: 14px; margin-top: 5px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    .modal { 
      display: none; position: fixed; top: 50%; left: 50%; 
      transform: translate(-50%, -50%); background: white; 
      padding: 30px; border-radius: 8px; z-index: 1000; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 500px; width: 90%; 
    }
    .overlay { 
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(0,0,0,0.5); z-index: 999; 
    }
    .close-btn { 
      position: absolute; top: 15px; right: 15px; background: none; 
      border: none; font-size: 24px; cursor: pointer; padding: 5px; 
      border-radius: 4px; 
    }
    .close-btn:focus { outline: 2px solid #0066cc; }
    .visually-hidden { 
      position: absolute; width: 1px; height: 1px; padding: 0; 
      margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); 
      white-space: nowrap; border: 0; 
    }
    .success { 
      color: #198754; background: #f8f9fa; padding: 15px; 
      border-radius: 4px; display: none; 
    }
  </style>
</head>
<body>
  <!-- 1. Кнопка вместо div -->
  <button class="btn" onclick="alert('Clicked!')">Кнопка</button>
  
  <!-- 2. Цвет контрастный -->
  <p class="text">Контрастный текст</p>
  
  <!-- 3. Изображение с alt -->
  <img src="chart.jpg" class="image" alt="График продаж 2024">
  
  <!-- 4. Форма с label -->
  <form aria-labelledby="form-title">
    <div class="form-group">
      <label for="username">Имя пользователя <span class="required" aria-hidden="true">*</span></label>
      <input type="text" id="username" name="username" required aria-required="true">
    </div>
  </form>

  <!-- Модальное окно с полной ARIA-поддержкой -->
  <header><h1>Товары</h1></header>
  <main>
    <article class="card">
      <img src="product.jpg" alt="XYZ Model 2024 - смартфон, 6.7&quot;">
      <h2>XYZ</h2>
      <p><strong style="color: #dc3545">25 000 </strong><span class="visually-hidden">рублей</span></p>
      <button onclick="openModal()" aria-label="Подробнее о XYZ">Подробнее</button>
    </article>
  </main>

  <div class="overlay" onclick="closeModal()"></div>
  <div class="modal" id="modal" role="dialog" aria-modal="true" 
       aria-labelledby="modal-title" aria-describedby="modal-desc" tabindex="-1">
    <h2 id="modal-title">Подробности</h2>
    <p id="modal-desc">XYZ - лучший выбор 2024 года!</p>
    <button class="close-btn" onclick="closeModal()" aria-label="Закрыть">
      <span class="visually-hidden">Закрыть</span>×</button>
    <div class="success" id="success" role="status" aria-live="polite" aria-atomic="true">
      Добавлено в корзину!
    </div>
  </div>

  <script>
    let previousActiveElement;
    const modal = document.getElementById('modal');

    function openModal() {
      previousActiveElement = document.activeElement;
      modal.style.display = 'block';
      document.querySelector('.overlay').style.display = 'block';
      document.getElementById('success').style.display = 'block';
      document.querySelectorAll('main *').forEach(el => el.setAttribute('aria-hidden', 'true'));
      modal.focus();
      document.addEventListener('keydown', handleEscape);
      modal.addEventListener('keydown', handleTab);
    }

    function closeModal() {
      modal.style.display = 'none';
      document.querySelector('.overlay').style.display = 'none';
      document.querySelectorAll('[aria-hidden="true"]').forEach(el => el.removeAttribute('aria-hidden'));
      if (previousActiveElement) previousActiveElement.focus();
      document.removeEventListener('keydown', handleEscape);
    }

    function handleEscape(event) {
      if (event.key === 'Escape') closeModal();
    }

    function handleTab(event) {
      if (event.key === 'Tab') {
        const focusableElements = modal.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];
        
        if (event.shiftKey && document.activeElement === firstElement) {
          event.preventDefault();
          lastElement.focus();
        } else if (!event.shiftKey && document.activeElement === lastElement) {
          event.preventDefault();
          firstElement.focus();
        }
      }
    }
  </script>
</body>
</html>

